public class org.bouncycastle.mail.smime.examples.SendSignedAndEncryptedMail extends java.lang.Object
{

    public void <init>()
    {
        org.bouncycastle.mail.smime.examples.SendSignedAndEncryptedMail r0;

        r0 := @this: org.bouncycastle.mail.smime.examples.SendSignedAndEncryptedMail;

        specialinvoke r0.<java.lang.Object: void <init>()>();

        return;
    }

    public static void main(java.lang.String[])
    {
        byte[] $r60;
        java.util.Enumeration $r51, $r61;
        java.math.BigInteger $r37;
        org.bouncycastle.mail.smime.SMIMEEnvelopedGenerator $r52;
        javax.mail.internet.MimeMultipart $r49;
        java.lang.Exception $r67, $r76, $r79;
        org.bouncycastle.asn1.smime.SMIMEEncryptionKeyPreferenceAttribute $r28;
        java.security.PrivateKey $r75;
        java.lang.StringBuilder $r68, $r69, $r71;
        java.io.ByteArrayOutputStream $r57;
        java.util.ArrayList $r45;
        javax.mail.internet.InternetAddress $r18, $r20;
        org.bouncycastle.mail.smime.SMIMESignedGenerator $r39;
        org.bouncycastle.asn1.smime.SMIMECapabilityVector $r23;
        java.lang.String $r5, $r6, $r8, $r10, $r11, $r15, $r19, $r21, $r34, $r42, $r43, $r55, r63, $r64, $r66, $r70, $r72, $r82;
        java.util.Properties $r14;
        org.bouncycastle.asn1.x509.X509Name $r30;
        javax.mail.internet.MimeMessage $r17, $r50, $r58;
        org.bouncycastle.asn1.smime.SMIMECapabilitiesAttribute $r38;
        org.bouncycastle.jce.provider.BouncyCastleProvider $r2;
        char[] $r7, $r12;
        javax.mail.Session $r16;
        java.security.cert.X509Certificate $r32, $r36, $r41, $r54;
        java.io.ByteArrayInputStream $r59;
        org.bouncycastle.asn1.DERObjectIdentifier $r24, $r25, $r26;
        boolean $z0, $z1, $z2, $z3;
        java.security.KeyStore $r3;
        java.security.Key $r13;
        java.security.cert.Certificate $r31, $r35, $r40, $r46, $r53;
        java.security.Principal $r33;
        java.security.cert.Certificate[] $r9;
        javax.mail.internet.MimeBodyPart $r56;
        java.lang.String[] r0;
        javax.activation.CommandMap $r1;
        int $i0;
        java.io.PrintStream $r73, $r77, $r80, $r81;
        javax.activation.MailcapCommandMap $r74;
        org.bouncycastle.asn1.ASN1EncodableVector $r27;
        java.io.FileInputStream $r4;
        java.security.cert.CollectionCertStoreParameters $r47;
        org.bouncycastle.asn1.cms.IssuerAndSerialNumber $r29;
        org.bouncycastle.asn1.cms.AttributeTable $r44;
        java.security.cert.CertStore $r48;
        javax.mail.Message$RecipientType $r22;
        java.lang.Object $r62, $r65;
        org.bouncycastle.mail.smime.SMIMEException $r78;

        r0 := @parameter0: java.lang.String[];

        $i0 = lengthof r0;

        if $i0 == 5 goto label01;

        $r73 = <java.lang.System: java.io.PrintStream err>;

        virtualinvoke $r73.<java.io.PrintStream: void println(java.lang.String)>("usage: SendSignedAndEncryptedMail <pkcs12Keystore> <password> <keyalias> <smtp server> <email address>");

        staticinvoke <java.lang.System: void exit(int)>(0);

     label01:
        $r1 = staticinvoke <javax.activation.CommandMap: javax.activation.CommandMap getDefaultCommandMap()>();

        $r74 = (javax.activation.MailcapCommandMap) $r1;

        virtualinvoke $r74.<javax.activation.MailcapCommandMap: void addMailcap(java.lang.String)>("application/pkcs7-signature;; x-java-content-handler=org.bouncycastle.mail.smime.handlers.pkcs7_signature");

        virtualinvoke $r74.<javax.activation.MailcapCommandMap: void addMailcap(java.lang.String)>("application/pkcs7-mime;; x-java-content-handler=org.bouncycastle.mail.smime.handlers.pkcs7_mime");

        virtualinvoke $r74.<javax.activation.MailcapCommandMap: void addMailcap(java.lang.String)>("application/x-pkcs7-signature;; x-java-content-handler=org.bouncycastle.mail.smime.handlers.x_pkcs7_signature");

        virtualinvoke $r74.<javax.activation.MailcapCommandMap: void addMailcap(java.lang.String)>("application/x-pkcs7-mime;; x-java-content-handler=org.bouncycastle.mail.smime.handlers.x_pkcs7_mime");

        virtualinvoke $r74.<javax.activation.MailcapCommandMap: void addMailcap(java.lang.String)>("multipart/signed;; x-java-content-handler=org.bouncycastle.mail.smime.handlers.multipart_signed");

        staticinvoke <javax.activation.CommandMap: void setDefaultCommandMap(javax.activation.CommandMap)>($r74);

        $r2 = new org.bouncycastle.jce.provider.BouncyCastleProvider;

        specialinvoke $r2.<org.bouncycastle.jce.provider.BouncyCastleProvider: void <init>()>();

        staticinvoke <java.security.Security: int addProvider(java.security.Provider)>($r2);

        $r3 = staticinvoke <java.security.KeyStore: java.security.KeyStore getInstance(java.lang.String,java.lang.String)>("PKCS12", "BC");

        $r4 = new java.io.FileInputStream;

        $r5 = r0[0];

        specialinvoke $r4.<java.io.FileInputStream: void <init>(java.lang.String)>($r5);

        $r6 = r0[1];

        $r7 = virtualinvoke $r6.<java.lang.String: char[] toCharArray()>();

        virtualinvoke $r3.<java.security.KeyStore: void load(java.io.InputStream,char[])>($r4, $r7);

        $r8 = r0[2];

        $r9 = virtualinvoke $r3.<java.security.KeyStore: java.security.cert.Certificate[] getCertificateChain(java.lang.String)>($r8);

        $r11 = r0[2];

        $r10 = r0[1];

        $r12 = virtualinvoke $r10.<java.lang.String: char[] toCharArray()>();

        $r13 = virtualinvoke $r3.<java.security.KeyStore: java.security.Key getKey(java.lang.String,char[])>($r11, $r12);

        $r75 = (java.security.PrivateKey) $r13;

        if $r75 != null goto label02;

        $r67 = new java.lang.Exception;

        $r68 = new java.lang.StringBuilder;

        specialinvoke $r68.<java.lang.StringBuilder: void <init>()>();

        $r69 = virtualinvoke $r68.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>("cannot find private key for alias: ");

        $r70 = r0[2];

        $r71 = virtualinvoke $r69.<java.lang.StringBuilder: java.lang.StringBuilder append(java.lang.String)>($r70);

        $r72 = virtualinvoke $r71.<java.lang.StringBuilder: java.lang.String toString()>();

        specialinvoke $r67.<java.lang.Exception: void <init>(java.lang.String)>($r72);

        throw $r67;

     label02:
        $r14 = staticinvoke <java.lang.System: java.util.Properties getProperties()>();

        $r15 = r0[3];

        virtualinvoke $r14.<java.util.Properties: java.lang.Object put(java.lang.Object,java.lang.Object)>("mail.smtp.host", $r15);

        $r16 = staticinvoke <javax.mail.Session: javax.mail.Session getDefaultInstance(java.util.Properties,javax.mail.Authenticator)>($r14, null);

        $r17 = new javax.mail.internet.MimeMessage;

        specialinvoke $r17.<javax.mail.internet.MimeMessage: void <init>(javax.mail.Session)>($r16);

        $r18 = new javax.mail.internet.InternetAddress;

        $r19 = r0[4];

        specialinvoke $r18.<javax.mail.internet.InternetAddress: void <init>(java.lang.String)>($r19);

        virtualinvoke $r17.<javax.mail.internet.MimeMessage: void setFrom(javax.mail.Address)>($r18);

        $r22 = <javax.mail.Message$RecipientType: javax.mail.Message$RecipientType TO>;

        $r20 = new javax.mail.internet.InternetAddress;

        $r21 = r0[4];

        specialinvoke $r20.<javax.mail.internet.InternetAddress: void <init>(java.lang.String)>($r21);

        virtualinvoke $r17.<javax.mail.internet.MimeMessage: void setRecipient(javax.mail.Message$RecipientType,javax.mail.Address)>($r22, $r20);

        virtualinvoke $r17.<javax.mail.internet.MimeMessage: void setSubject(java.lang.String)>("example encrypted message");

        virtualinvoke $r17.<javax.mail.internet.MimeMessage: void setContent(java.lang.Object,java.lang.String)>("example encrypted message", "text/plain");

        virtualinvoke $r17.<javax.mail.internet.MimeMessage: void saveChanges()>();

        $r23 = new org.bouncycastle.asn1.smime.SMIMECapabilityVector;

        specialinvoke $r23.<org.bouncycastle.asn1.smime.SMIMECapabilityVector: void <init>()>();

        $r24 = <org.bouncycastle.asn1.smime.SMIMECapability: org.bouncycastle.asn1.DERObjectIdentifier dES_EDE3_CBC>;

        virtualinvoke $r23.<org.bouncycastle.asn1.smime.SMIMECapabilityVector: void addCapability(org.bouncycastle.asn1.DERObjectIdentifier)>($r24);

        $r25 = <org.bouncycastle.asn1.smime.SMIMECapability: org.bouncycastle.asn1.DERObjectIdentifier rC2_CBC>;

        virtualinvoke $r23.<org.bouncycastle.asn1.smime.SMIMECapabilityVector: void addCapability(org.bouncycastle.asn1.DERObjectIdentifier,int)>($r25, 128);

        $r26 = <org.bouncycastle.asn1.smime.SMIMECapability: org.bouncycastle.asn1.DERObjectIdentifier dES_CBC>;

        virtualinvoke $r23.<org.bouncycastle.asn1.smime.SMIMECapabilityVector: void addCapability(org.bouncycastle.asn1.DERObjectIdentifier)>($r26);

        $r27 = new org.bouncycastle.asn1.ASN1EncodableVector;

        specialinvoke $r27.<org.bouncycastle.asn1.ASN1EncodableVector: void <init>()>();

        $r28 = new org.bouncycastle.asn1.smime.SMIMEEncryptionKeyPreferenceAttribute;

        $r29 = new org.bouncycastle.asn1.cms.IssuerAndSerialNumber;

        $r30 = new org.bouncycastle.asn1.x509.X509Name;

        $r31 = $r9[0];

        $r32 = (java.security.cert.X509Certificate) $r31;

        $r33 = virtualinvoke $r32.<java.security.cert.X509Certificate: java.security.Principal getIssuerDN()>();

        $r34 = interfaceinvoke $r33.<java.security.Principal: java.lang.String getName()>();

        specialinvoke $r30.<org.bouncycastle.asn1.x509.X509Name: void <init>(java.lang.String)>($r34);

        $r35 = $r9[0];

        $r36 = (java.security.cert.X509Certificate) $r35;

        $r37 = virtualinvoke $r36.<java.security.cert.X509Certificate: java.math.BigInteger getSerialNumber()>();

        specialinvoke $r29.<org.bouncycastle.asn1.cms.IssuerAndSerialNumber: void <init>(org.bouncycastle.asn1.x509.X509Name,java.math.BigInteger)>($r30, $r37);

        specialinvoke $r28.<org.bouncycastle.asn1.smime.SMIMEEncryptionKeyPreferenceAttribute: void <init>(org.bouncycastle.asn1.cms.IssuerAndSerialNumber)>($r29);

        virtualinvoke $r27.<org.bouncycastle.asn1.ASN1EncodableVector: void add(org.bouncycastle.asn1.DEREncodable)>($r28);

        $r38 = new org.bouncycastle.asn1.smime.SMIMECapabilitiesAttribute;

        specialinvoke $r38.<org.bouncycastle.asn1.smime.SMIMECapabilitiesAttribute: void <init>(org.bouncycastle.asn1.smime.SMIMECapabilityVector)>($r23);

        virtualinvoke $r27.<org.bouncycastle.asn1.ASN1EncodableVector: void add(org.bouncycastle.asn1.DEREncodable)>($r38);

        $r39 = new org.bouncycastle.mail.smime.SMIMESignedGenerator;

        specialinvoke $r39.<org.bouncycastle.mail.smime.SMIMESignedGenerator: void <init>()>();

        $r40 = $r9[0];

        $r41 = (java.security.cert.X509Certificate) $r40;

        $r42 = "DSA";

        $r43 = interfaceinvoke $r75.<java.security.PrivateKey: java.lang.String getAlgorithm()>();

        $z0 = virtualinvoke $r42.<java.lang.String: boolean equals(java.lang.Object)>($r43);

        if $z0 == 0 goto label03;

        $r82 = <org.bouncycastle.mail.smime.SMIMESignedGenerator: java.lang.String DIGEST_SHA1>;

        goto label04;

     label03:
        $r82 = <org.bouncycastle.mail.smime.SMIMESignedGenerator: java.lang.String DIGEST_MD5>;

     label04:
        $r44 = new org.bouncycastle.asn1.cms.AttributeTable;

        specialinvoke $r44.<org.bouncycastle.asn1.cms.AttributeTable: void <init>(org.bouncycastle.asn1.DEREncodableVector)>($r27);

        virtualinvoke $r39.<org.bouncycastle.mail.smime.SMIMESignedGenerator: void addSigner(java.security.PrivateKey,java.security.cert.X509Certificate,java.lang.String,org.bouncycastle.asn1.cms.AttributeTable,org.bouncycastle.asn1.cms.AttributeTable)>($r75, $r41, $r82, $r44, null);

        $r45 = new java.util.ArrayList;

        specialinvoke $r45.<java.util.ArrayList: void <init>()>();

        $r46 = $r9[0];

        interfaceinvoke $r45.<java.util.List: boolean add(java.lang.Object)>($r46);

        $r47 = new java.security.cert.CollectionCertStoreParameters;

        specialinvoke $r47.<java.security.cert.CollectionCertStoreParameters: void <init>(java.util.Collection)>($r45);

        $r48 = staticinvoke <java.security.cert.CertStore: java.security.cert.CertStore getInstance(java.lang.String,java.security.cert.CertStoreParameters,java.lang.String)>("Collection", $r47, "BC");

        virtualinvoke $r39.<org.bouncycastle.mail.smime.SMIMESignedGenerator: void addCertificatesAndCRLs(java.security.cert.CertStore)>($r48);

        $r49 = virtualinvoke $r39.<org.bouncycastle.mail.smime.SMIMESignedGenerator: javax.mail.internet.MimeMultipart generate(javax.mail.internet.MimeMessage,java.lang.String)>($r17, "BC");

        $r50 = new javax.mail.internet.MimeMessage;

        specialinvoke $r50.<javax.mail.internet.MimeMessage: void <init>(javax.mail.Session)>($r16);

        $r51 = virtualinvoke $r17.<javax.mail.internet.MimeMessage: java.util.Enumeration getAllHeaderLines()>();

     label05:
        $z3 = interfaceinvoke $r51.<java.util.Enumeration: boolean hasMoreElements()>();

        if $z3 == 0 goto label06;

        $r65 = interfaceinvoke $r51.<java.util.Enumeration: java.lang.Object nextElement()>();

        $r66 = (java.lang.String) $r65;

        virtualinvoke $r50.<javax.mail.internet.MimeMessage: void addHeaderLine(java.lang.String)>($r66);

        goto label05;

     label06:
        virtualinvoke $r50.<javax.mail.internet.MimeMessage: void setContent(javax.mail.Multipart)>($r49);

        virtualinvoke $r50.<javax.mail.internet.MimeMessage: void saveChanges()>();

        $r52 = new org.bouncycastle.mail.smime.SMIMEEnvelopedGenerator;

        specialinvoke $r52.<org.bouncycastle.mail.smime.SMIMEEnvelopedGenerator: void <init>()>();

        $r53 = $r9[0];

        $r54 = (java.security.cert.X509Certificate) $r53;

        virtualinvoke $r52.<org.bouncycastle.mail.smime.SMIMEEnvelopedGenerator: void addKeyTransRecipient(java.security.cert.X509Certificate)>($r54);

        $r55 = <org.bouncycastle.mail.smime.SMIMEEnvelopedGenerator: java.lang.String RC2_CBC>;

        $r56 = virtualinvoke $r52.<org.bouncycastle.mail.smime.SMIMEEnvelopedGenerator: javax.mail.internet.MimeBodyPart generate(javax.mail.internet.MimeMessage,java.lang.String,java.lang.String)>($r50, $r55, "BC");

        $r57 = new java.io.ByteArrayOutputStream;

        specialinvoke $r57.<java.io.ByteArrayOutputStream: void <init>()>();

        virtualinvoke $r56.<javax.mail.internet.MimeBodyPart: void writeTo(java.io.OutputStream)>($r57);

        $r58 = new javax.mail.internet.MimeMessage;

        $r59 = new java.io.ByteArrayInputStream;

        $r60 = virtualinvoke $r57.<java.io.ByteArrayOutputStream: byte[] toByteArray()>();

        specialinvoke $r59.<java.io.ByteArrayInputStream: void <init>(byte[])>($r60);

        specialinvoke $r58.<javax.mail.internet.MimeMessage: void <init>(javax.mail.Session,java.io.InputStream)>($r16, $r59);

        $r61 = virtualinvoke $r17.<javax.mail.internet.MimeMessage: java.util.Enumeration getAllHeaderLines()>();

     label07:
        $z1 = interfaceinvoke $r61.<java.util.Enumeration: boolean hasMoreElements()>();

        if $z1 == 0 goto label09;

        $r62 = interfaceinvoke $r61.<java.util.Enumeration: java.lang.Object nextElement()>();

        r63 = (java.lang.String) $r62;

        $r64 = staticinvoke <org.bouncycastle.util.Strings: java.lang.String toLowerCase(java.lang.String)>(r63);

        $z2 = virtualinvoke $r64.<java.lang.String: boolean startsWith(java.lang.String)>("content-");

        if $z2 != 0 goto label08;

        virtualinvoke $r58.<javax.mail.internet.MimeMessage: void addHeaderLine(java.lang.String)>(r63);

     label08:
        goto label07;

     label09:
        staticinvoke <javax.mail.Transport: void send(javax.mail.Message)>($r58);

     label10:
        goto label13;

     label11:
        $r78 := @caughtexception;

        $r79 = virtualinvoke $r78.<org.bouncycastle.mail.smime.SMIMEException: java.lang.Exception getUnderlyingException()>();

        $r80 = <java.lang.System: java.io.PrintStream err>;

        virtualinvoke $r79.<java.lang.Exception: void printStackTrace(java.io.PrintStream)>($r80);

        $r81 = <java.lang.System: java.io.PrintStream err>;

        virtualinvoke $r78.<org.bouncycastle.mail.smime.SMIMEException: void printStackTrace(java.io.PrintStream)>($r81);

        goto label13;

     label12:
        $r76 := @caughtexception;

        $r77 = <java.lang.System: java.io.PrintStream err>;

        virtualinvoke $r76.<java.lang.Exception: void printStackTrace(java.io.PrintStream)>($r77);

     label13:
        return;

        catch org.bouncycastle.mail.smime.SMIMEException from label01 to label10 with label11;
        catch java.lang.Exception from label01 to label10 with label12;
    }
}
