public class org.mortbay.servlet.ProxyServlet extends java.lang.Object implements javax.servlet.Servlet
{
    protected java.util.HashSet _DontProxyHeaders;
    protected javax.servlet.ServletConfig _config;
    protected javax.servlet.ServletContext _context;

    public void <init>()
    {
        java.util.HashSet $r1, $r2, $r3, $r4, $r5, $r6, $r7, $r8, $r9, $r10;
        org.mortbay.servlet.ProxyServlet r0;

        r0 := @this: org.mortbay.servlet.ProxyServlet;

        specialinvoke r0.<java.lang.Object: void <init>()>();

        $r1 = new java.util.HashSet;

        specialinvoke $r1.<java.util.HashSet: void <init>()>();

        r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders> = $r1;

        $r2 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r2.<java.util.HashSet: boolean add(java.lang.Object)>("proxy-connection");

        $r3 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r3.<java.util.HashSet: boolean add(java.lang.Object)>("connection");

        $r4 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r4.<java.util.HashSet: boolean add(java.lang.Object)>("keep-alive");

        $r5 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r5.<java.util.HashSet: boolean add(java.lang.Object)>("transfer-encoding");

        $r6 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r6.<java.util.HashSet: boolean add(java.lang.Object)>("te");

        $r7 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r7.<java.util.HashSet: boolean add(java.lang.Object)>("trailer");

        $r8 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r8.<java.util.HashSet: boolean add(java.lang.Object)>("proxy-authorization");

        $r9 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r9.<java.util.HashSet: boolean add(java.lang.Object)>("proxy-authenticate");

        $r10 = r0.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        virtualinvoke $r10.<java.util.HashSet: boolean add(java.lang.Object)>("upgrade");

        return;
    }

    public void init(javax.servlet.ServletConfig) throws javax.servlet.ServletException
    {
        javax.servlet.ServletContext $r2;
        javax.servlet.ServletConfig r1;
        org.mortbay.servlet.ProxyServlet r0;

        r0 := @this: org.mortbay.servlet.ProxyServlet;

        r1 := @parameter0: javax.servlet.ServletConfig;

        r0.<org.mortbay.servlet.ProxyServlet: javax.servlet.ServletConfig _config> = r1;

        $r2 = interfaceinvoke r1.<javax.servlet.ServletConfig: javax.servlet.ServletContext getServletContext()>();

        r0.<org.mortbay.servlet.ProxyServlet: javax.servlet.ServletContext _context> = $r2;

        return;
    }

    public javax.servlet.ServletConfig getServletConfig()
    {
        javax.servlet.ServletConfig $r1;
        org.mortbay.servlet.ProxyServlet r0;

        r0 := @this: org.mortbay.servlet.ProxyServlet;

        $r1 = r0.<org.mortbay.servlet.ProxyServlet: javax.servlet.ServletConfig _config>;

        return $r1;
    }

    public void service(javax.servlet.ServletRequest, javax.servlet.ServletResponse) throws javax.servlet.ServletException, java.io.IOException
    {
        java.net.HttpURLConnection r42;
        java.util.Enumeration $r27, $r44;
        java.lang.Exception $r37, $r39;
        javax.servlet.http.HttpServletRequest r1;
        java.net.URLConnection $r12;
        java.lang.StringBuffer $r32, $r33, $r34, $r36;
        java.lang.String $r4, $r5, $r6, $r7, $r9, $r10, $r13, $r14, $r17, $r19, $r20, $r21, $r22, $r24, $r26, $r29, $r30, $r31, $r35, r41, r43, r45, r46, r49, r50, $r51;
        org.mortbay.servlet.ProxyServlet r8;
        javax.servlet.ServletContext $r38, $r40;
        java.net.URL $r11;
        boolean $z0, $z1, $z2, $z3, $z4, $z5, $z6, $z7, z8, z9, $z10, $z11;
        javax.servlet.ServletResponse r2;
        javax.servlet.ServletInputStream $r47;
        java.util.HashSet $r15, $r25;
        javax.servlet.ServletOutputStream $r16;
        int $i0, $i1, $i2, $i3, $i4, i5;
        java.io.OutputStream $r18;
        javax.servlet.ServletRequest r0;
        javax.servlet.http.HttpServletResponse r3;
        java.lang.Object $r23, $r28;
        java.io.InputStream r48;

        r8 := @this: org.mortbay.servlet.ProxyServlet;

        r0 := @parameter0: javax.servlet.ServletRequest;

        r2 := @parameter1: javax.servlet.ServletResponse;

        r1 = (javax.servlet.http.HttpServletRequest) r0;

        r3 = (javax.servlet.http.HttpServletResponse) r2;

        $r4 = "CONNECT";

        $r5 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getMethod()>();

        $z0 = virtualinvoke $r4.<java.lang.String: boolean equalsIgnoreCase(java.lang.String)>($r5);

        if $z0 == 0 goto label01;

        virtualinvoke r8.<org.mortbay.servlet.ProxyServlet: void handleConnect(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)>(r1, r3);

        goto label32;

     label01:
        $r6 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getRequestURI()>();

        r41 = $r6;

        $r7 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getQueryString()>();

        if $r7 == null goto label02;

        $r32 = new java.lang.StringBuffer;

        specialinvoke $r32.<java.lang.StringBuffer: void <init>()>();

        $r33 = virtualinvoke $r32.<java.lang.StringBuffer: java.lang.StringBuffer append(java.lang.String)>($r6);

        $r34 = virtualinvoke $r33.<java.lang.StringBuffer: java.lang.StringBuffer append(java.lang.String)>("?");

        $r35 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getQueryString()>();

        $r36 = virtualinvoke $r34.<java.lang.StringBuffer: java.lang.StringBuffer append(java.lang.String)>($r35);

        r41 = virtualinvoke $r36.<java.lang.StringBuffer: java.lang.String toString()>();

     label02:
        $r9 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getScheme()>();

        $r10 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getServerName()>();

        $i0 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: int getServerPort()>();

        $r11 = virtualinvoke r8.<org.mortbay.servlet.ProxyServlet: java.net.URL proxyHttpURL(java.lang.String,java.lang.String,int,java.lang.String)>($r9, $r10, $i0, r41);

        $r12 = virtualinvoke $r11.<java.net.URL: java.net.URLConnection openConnection()>();

        virtualinvoke $r12.<java.net.URLConnection: void setAllowUserInteraction(boolean)>(0);

        r42 = null;

        $z1 = $r12 instanceof java.net.HttpURLConnection;

        if $z1 == 0 goto label03;

        r42 = (java.net.HttpURLConnection) $r12;

        $r31 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getMethod()>();

        virtualinvoke r42.<java.net.HttpURLConnection: void setRequestMethod(java.lang.String)>($r31);

        virtualinvoke r42.<java.net.HttpURLConnection: void setInstanceFollowRedirects(boolean)>(0);

     label03:
        $r13 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getHeader(java.lang.String)>("Connection");

        r43 = $r13;

        if $r13 == null goto label05;

        $r30 = virtualinvoke $r13.<java.lang.String: java.lang.String toLowerCase()>();

        r43 = $r30;

        $z6 = virtualinvoke $r30.<java.lang.String: boolean equals(java.lang.Object)>("keep-alive");

        if $z6 != 0 goto label04;

        $z7 = virtualinvoke $r30.<java.lang.String: boolean equals(java.lang.Object)>("close");

        if $z7 == 0 goto label05;

     label04:
        r43 = null;

     label05:
        z8 = 0;

        z9 = 0;

        $r44 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.util.Enumeration getHeaderNames()>();

     label06:
        $z10 = interfaceinvoke $r44.<java.util.Enumeration: boolean hasMoreElements()>();

        if $z10 == 0 goto label13;

        $r23 = interfaceinvoke $r44.<java.util.Enumeration: java.lang.Object nextElement()>();

        r45 = (java.lang.String) $r23;

        $r24 = virtualinvoke r45.<java.lang.String: java.lang.String toLowerCase()>();

        $r25 = r8.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        $z3 = virtualinvoke $r25.<java.util.HashSet: boolean contains(java.lang.Object)>($r24);

        if $z3 == 0 goto label07;

        goto label06;

     label07:
        if r43 == null goto label08;

        $i4 = virtualinvoke r43.<java.lang.String: int indexOf(java.lang.String)>($r24);

        if $i4 < 0 goto label08;

        goto label06;

     label08:
        $r26 = "content-type";

        $z4 = virtualinvoke $r26.<java.lang.String: boolean equals(java.lang.Object)>($r24);

        if $z4 == 0 goto label09;

        z9 = 1;

     label09:
        $r27 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.util.Enumeration getHeaders(java.lang.String)>(r45);

     label10:
        $z11 = interfaceinvoke $r27.<java.util.Enumeration: boolean hasMoreElements()>();

        if $z11 == 0 goto label12;

        $r28 = interfaceinvoke $r27.<java.util.Enumeration: java.lang.Object nextElement()>();

        r46 = (java.lang.String) $r28;

        if r46 == null goto label11;

        virtualinvoke $r12.<java.net.URLConnection: void addRequestProperty(java.lang.String,java.lang.String)>(r45, r46);

        $r29 = "X-Forwarded-For";

        $z5 = virtualinvoke $r29.<java.lang.String: boolean equalsIgnoreCase(java.lang.String)>(r45);

        z8 = z8 | $z5;

     label11:
        goto label10;

     label12:
        goto label06;

     label13:
        virtualinvoke $r12.<java.net.URLConnection: void setRequestProperty(java.lang.String,java.lang.String)>("Via", "1.1 (jetty)");

        if z8 != 0 goto label14;

        $r19 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getRemoteAddr()>();

        virtualinvoke $r12.<java.net.URLConnection: void addRequestProperty(java.lang.String,java.lang.String)>("X-Forwarded-For", $r19);

        $r20 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getScheme()>();

        virtualinvoke $r12.<java.net.URLConnection: void addRequestProperty(java.lang.String,java.lang.String)>("X-Forwarded-Proto", $r20);

        $r21 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getServerName()>();

        virtualinvoke $r12.<java.net.URLConnection: void addRequestProperty(java.lang.String,java.lang.String)>("X-Forwarded-Host", $r21);

        $r22 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getLocalName()>();

        virtualinvoke $r12.<java.net.URLConnection: void addRequestProperty(java.lang.String,java.lang.String)>("X-Forwarded-Server", $r22);

     label14:
        $r14 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: java.lang.String getHeader(java.lang.String)>("Cache-Control");

        if $r14 == null goto label16;

        $i2 = virtualinvoke $r14.<java.lang.String: int indexOf(java.lang.String)>("no-cache");

        if $i2 >= 0 goto label15;

        $i3 = virtualinvoke $r14.<java.lang.String: int indexOf(java.lang.String)>("no-store");

        if $i3 < 0 goto label16;

     label15:
        virtualinvoke $r12.<java.net.URLConnection: void setUseCaches(boolean)>(0);

     label16:
        virtualinvoke $r12.<java.net.URLConnection: void setDoInput(boolean)>(1);

        $r47 = interfaceinvoke r1.<javax.servlet.http.HttpServletRequest: javax.servlet.ServletInputStream getInputStream()>();

        if z9 == 0 goto label17;

        virtualinvoke $r12.<java.net.URLConnection: void setDoOutput(boolean)>(1);

        $r18 = virtualinvoke $r12.<java.net.URLConnection: java.io.OutputStream getOutputStream()>();

        staticinvoke <org.mortbay.util.IO: void copy(java.io.InputStream,java.io.OutputStream)>($r47, $r18);

     label17:
        virtualinvoke $r12.<java.net.URLConnection: void connect()>();

     label18:
        goto label20;

     label19:
        $r39 := @caughtexception;

        $r40 = r8.<org.mortbay.servlet.ProxyServlet: javax.servlet.ServletContext _context>;

        interfaceinvoke $r40.<javax.servlet.ServletContext: void log(java.lang.String,java.lang.Throwable)>("proxy", $r39);

     label20:
        r48 = null;

        if r42 == null goto label21;

        r48 = virtualinvoke r42.<java.net.HttpURLConnection: java.io.InputStream getErrorStream()>();

        $i1 = virtualinvoke r42.<java.net.HttpURLConnection: int getResponseCode()>();

        $r17 = virtualinvoke r42.<java.net.HttpURLConnection: java.lang.String getResponseMessage()>();

        interfaceinvoke r3.<javax.servlet.http.HttpServletResponse: void setStatus(int,java.lang.String)>($i1, $r17);

     label21:
        if r48 != null goto label25;

     label22:
        r48 = virtualinvoke $r12.<java.net.URLConnection: java.io.InputStream getInputStream()>();

     label23:
        goto label25;

     label24:
        $r37 := @caughtexception;

        $r38 = r8.<org.mortbay.servlet.ProxyServlet: javax.servlet.ServletContext _context>;

        interfaceinvoke $r38.<javax.servlet.ServletContext: void log(java.lang.String,java.lang.Throwable)>("stream", $r37);

        r48 = virtualinvoke r42.<java.net.HttpURLConnection: java.io.InputStream getErrorStream()>();

     label25:
        interfaceinvoke r3.<javax.servlet.http.HttpServletResponse: void setHeader(java.lang.String,java.lang.String)>("Date", null);

        interfaceinvoke r3.<javax.servlet.http.HttpServletResponse: void setHeader(java.lang.String,java.lang.String)>("Server", null);

        i5 = 0;

        r49 = virtualinvoke $r12.<java.net.URLConnection: java.lang.String getHeaderFieldKey(int)>(0);

        r50 = virtualinvoke $r12.<java.net.URLConnection: java.lang.String getHeaderField(int)>(0);

     label26:
        if r49 != null goto label27;

        if r50 == null goto label31;

     label27:
        if r49 == null goto label28;

        $r51 = virtualinvoke r49.<java.lang.String: java.lang.String toLowerCase()>();

        goto label29;

     label28:
        $r51 = null;

     label29:
        if r49 == null goto label30;

        if r50 == null goto label30;

        $r15 = r8.<org.mortbay.servlet.ProxyServlet: java.util.HashSet _DontProxyHeaders>;

        $z2 = virtualinvoke $r15.<java.util.HashSet: boolean contains(java.lang.Object)>($r51);

        if $z2 != 0 goto label30;

        interfaceinvoke r3.<javax.servlet.http.HttpServletResponse: void addHeader(java.lang.String,java.lang.String)>(r49, r50);

     label30:
        i5 = i5 + 1;

        r49 = virtualinvoke $r12.<java.net.URLConnection: java.lang.String getHeaderFieldKey(int)>(i5);

        r50 = virtualinvoke $r12.<java.net.URLConnection: java.lang.String getHeaderField(int)>(i5);

        goto label26;

     label31:
        interfaceinvoke r3.<javax.servlet.http.HttpServletResponse: void addHeader(java.lang.String,java.lang.String)>("Via", "1.1 (jetty)");

        if r48 == null goto label32;

        $r16 = interfaceinvoke r3.<javax.servlet.http.HttpServletResponse: javax.servlet.ServletOutputStream getOutputStream()>();

        staticinvoke <org.mortbay.util.IO: void copy(java.io.InputStream,java.io.OutputStream)>(r48, $r16);

     label32:
        return;

        catch java.lang.Exception from label16 to label18 with label19;
        catch java.lang.Exception from label22 to label23 with label24;
    }

    protected java.net.URL proxyHttpURL(java.lang.String, java.lang.String, int, java.lang.String) throws java.net.MalformedURLException
    {
        java.net.URL $r0;
        org.mortbay.servlet.ProxyServlet r4;
        int i0;
        java.lang.String r1, r2, r3;

        r4 := @this: org.mortbay.servlet.ProxyServlet;

        r1 := @parameter0: java.lang.String;

        r2 := @parameter1: java.lang.String;

        i0 := @parameter2: int;

        r3 := @parameter3: java.lang.String;

        $r0 = new java.net.URL;

        specialinvoke $r0.<java.net.URL: void <init>(java.lang.String,java.lang.String,int,java.lang.String)>(r1, r2, i0, r3);

        return $r0;
    }

    public void handleConnect(javax.servlet.http.HttpServletRequest, javax.servlet.http.HttpServletResponse) throws java.io.IOException
    {
        java.net.Socket $r10;
        javax.servlet.ServletInputStream $r8;
        java.net.InetAddress $r11;
        javax.servlet.http.HttpServletRequest r0;
        javax.servlet.ServletOutputStream $r9;
        int $i0, $i1, $i2, $i3, $i4, $i5, $i6;
        java.lang.String $r1, $r3, r5, r6;
        java.io.OutputStream $r13;
        javax.servlet.http.HttpServletResponse r2;
        java.net.InetSocketAddress $r7;
        org.mortbay.servlet.ProxyServlet r4;
        java.io.InputStream $r12;

        r4 := @this: org.mortbay.servlet.ProxyServlet;

        r0 := @parameter0: javax.servlet.http.HttpServletRequest;

        r2 := @parameter1: javax.servlet.http.HttpServletResponse;

        $r1 = interfaceinvoke r0.<javax.servlet.http.HttpServletRequest: java.lang.String getRequestURI()>();

        r5 = "";

        r6 = "";

        $i0 = virtualinvoke $r1.<java.lang.String: int indexOf(int)>(58);

        if $i0 < 0 goto label1;

        $i1 = $i0 + 1;

        r5 = virtualinvoke $r1.<java.lang.String: java.lang.String substring(int)>($i1);

        $r3 = virtualinvoke $r1.<java.lang.String: java.lang.String substring(int,int)>(0, $i0);

        r6 = $r3;

        $i2 = virtualinvoke $r3.<java.lang.String: int indexOf(int)>(47);

        if $i2 <= 0 goto label1;

        $i3 = virtualinvoke $r3.<java.lang.String: int indexOf(int)>(47);

        $i4 = $i3 + 1;

        r6 = virtualinvoke $r3.<java.lang.String: java.lang.String substring(int)>($i4);

     label1:
        $r7 = new java.net.InetSocketAddress;

        $i5 = staticinvoke <java.lang.Integer: int parseInt(java.lang.String)>(r5);

        specialinvoke $r7.<java.net.InetSocketAddress: void <init>(java.lang.String,int)>(r6, $i5);

        $r8 = interfaceinvoke r0.<javax.servlet.http.HttpServletRequest: javax.servlet.ServletInputStream getInputStream()>();

        $r9 = interfaceinvoke r2.<javax.servlet.http.HttpServletResponse: javax.servlet.ServletOutputStream getOutputStream()>();

        $r10 = new java.net.Socket;

        $r11 = virtualinvoke $r7.<java.net.InetSocketAddress: java.net.InetAddress getAddress()>();

        $i6 = virtualinvoke $r7.<java.net.InetSocketAddress: int getPort()>();

        specialinvoke $r10.<java.net.Socket: void <init>(java.net.InetAddress,int)>($r11, $i6);

        interfaceinvoke r2.<javax.servlet.http.HttpServletResponse: void setStatus(int)>(200);

        interfaceinvoke r2.<javax.servlet.http.HttpServletResponse: void setHeader(java.lang.String,java.lang.String)>("Connection", "close");

        interfaceinvoke r2.<javax.servlet.http.HttpServletResponse: void flushBuffer()>();

        $r12 = virtualinvoke $r10.<java.net.Socket: java.io.InputStream getInputStream()>();

        staticinvoke <org.mortbay.util.IO: void copyThread(java.io.InputStream,java.io.OutputStream)>($r12, $r9);

        $r13 = virtualinvoke $r10.<java.net.Socket: java.io.OutputStream getOutputStream()>();

        staticinvoke <org.mortbay.util.IO: void copy(java.io.InputStream,java.io.OutputStream)>($r8, $r13);

        return;
    }

    public java.lang.String getServletInfo()
    {
        org.mortbay.servlet.ProxyServlet r0;

        r0 := @this: org.mortbay.servlet.ProxyServlet;

        return "Proxy Servlet";
    }

    public void destroy()
    {
        org.mortbay.servlet.ProxyServlet r0;

        r0 := @this: org.mortbay.servlet.ProxyServlet;

        return;
    }
}
